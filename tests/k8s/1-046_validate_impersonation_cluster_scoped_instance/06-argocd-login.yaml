apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
- script: |
    api_server=$(kubetl get routes -n argocd-test-impersonation --field-selector metadata.name=argocd-test-server -o jsonpath="{.items[*]['spec.host']}")
    password=$(kubectl get secret argocd-test-cluster -n argocd-test-impersonation -o jsonpath='{.data.admin\.password}' | base64 -d)
    
    argocd login $api_server --username admin --password $password --insecure
    
    argocd app sync guestbook

    sleep 5