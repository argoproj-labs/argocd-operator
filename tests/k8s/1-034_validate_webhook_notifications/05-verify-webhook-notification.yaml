apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
# verify no x509 in notifications-controller logs
- script: | 
    #!/bin/bash
    kubectl -n $NAMESPACE logs deployment.apps/example-notifications-controller | grep "x509"

    PREV_CMD=$?
    if [ $PREV_CMD -eq 1 ]; then
        exit 0
    else
        exit 1
    fi
# verify notification delivery
- script: | 
    #!/bin/bash

    # delays could occur in receiving notification, hence retry before failing
    for i in {1..5}
    do
        sleep 5
        kubectl -n $NAMESPACE logs deployment.apps/webhook | grep '{"created":"my-app-3","type":"Directory"}' && break
    done